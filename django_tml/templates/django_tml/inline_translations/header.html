<script>
    function tml_add_script(doc, id, src, onload) {
        var script = doc.createElement('script');
        script.setAttribute('id', id); script.setAttribute('type', 'application/javascript');
        if (src.indexOf('//') != -1)  script.setAttribute('src', src);
        else script.setAttribute('src', '{{application.tools.host}}' + src);
        script.setAttribute('charset', 'UTF-8');
        if (onload) script.onload = onload;
        doc.getElementsByTagName('head')[0].appendChild(script);
        return script;
    }
    (function() {
        if (window.addEventListener) window.addEventListener('load', tml_init, false); // Standard
        else if (window.attachEvent) window.attachEvent('onload', tml_init); // Microsoft
        window.setTimeout(function() {  // just in case, hit it one more time a second later
            tml_init();
        }, 1000);

        function tml_init() {
            if (window.tml_already_initialized) return;
            window.tml_already_initialized = true;
            tml_add_script(window.document, 'tml-agent', '{{ agent_host }}', function() {
                Trex.init('{{ application_key }}', {{ agent_config|safe }});
              });
        }
    })();
</script>
