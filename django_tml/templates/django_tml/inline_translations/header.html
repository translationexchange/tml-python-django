{% if caller == "middleware" or not TML.agent.force_injection %}
<script>
  (function() {
    var script = window.document.createElement('script');
    script.setAttribute('id', 'tml-agent');
    script.setAttribute('type', 'application/javascript');
    script.setAttribute('src', '{{ agent_host }}');
    script.setAttribute('charset', 'UTF-8');

    script.onload = function() {
       Trex.init('{{ application_key }}', {{ agent_config|safe }});
    };
    window.document.getElementsByTagName('head')[0].appendChild(script);

  })();
</script>

{% endif %}
